/* jQuery.tableLiveEdit.pack.js
* Docs: http://jarrettmeyer.com/portfolio/jQuery-tableLiveEdit/
* License: http://jarrettmeyer.com/license/
* Version: 1.0.2
* Packed by http://dean.edwards.name/packer/
*/
(function($){$.fn.tableLiveEdit=function(settings){var config={formId:"_tableLiveEdit",modelId:"id",addLink:"add-link",cancelButton:"live-edit-cancel",createButton:"live-edit-create",deleteLink:"delete-link",deleteConfirmation:"You are about to delete a row. This is permanent. Are you absolutely sure?",editLink:"edit-link",rowPrefix:"row-",updateButton:"live-edit-update",createPath:"./create",showPath:"./show/{0}",updatePath:"./{0}/update",usePostUpdate:false,useHighlight:false};if(settings){$.extend(config,settings)}return this.each(function(){var table=$(this);(function(){var methods={ensureFormExists:function(){var forms=$(this).parents("form");if(forms.length===0){table.wrap("<form action=\"\" method=\"post\" id=\""+config.formId+"\"></form>")}},registerAddLink:function(){$("#"+config.addLink).unbind("click");$("#"+config.addLink).click(function(e){e.preventDefault();var url=$(this).attr("href");methods.hideEditLinks();$.get(url,{},function(html){$("tbody").append(html);methods.registerCreateButton();methods.registerCancelButton()})})},registerCancelButton:function(){$("#"+config.cancelButton).click(function(e){e.preventDefault();var rowId=$("#"+config.modelId).val();var selector="#"+config.rowPrefix+rowId;if(rowId>0){$.get(config.showPath.replace("{0}",rowId),{},function(html){$(selector).replaceWith(html)})}else{$(selector).remove()}methods.showEditLinks()})},registerCreateButton:function(){$("#"+config.createButton).click(function(e){methods.submitForm(this,e,config.createPath,true)})},registerDeleteLinks:function(){$("."+config.deleteLink).unbind("click");$("."+config.deleteLink).click(function(e){e.preventDefault();if(config.deleteConfirmation&&!window.confirm(config.deleteConfirmation)){return false}var link=$(this);$.ajax({type:"delete",url:link.attr("href")});link.parents("tr").remove()})},registerEditLinks:function(){$("."+config.editLink).unbind("click");$("."+config.editLink).click(function(e){e.preventDefault();methods.hideEditLinks();var url=$(this).attr("href");var row=$(this).parents("tr");$.get(url,{},function(html){row.replaceWith(html);methods.registerCancelButton();methods.registerUpdateButton()})})},registerUpdateButton:function(){$("#"+config.updateButton).click(function(e){var id=$(this).parents("tr")[0].id.match(/(\d+)/)[1];methods.submitForm(this,e,config.updatePath.replace("{0}",id),false)})},submitForm:function(element,event,url,isNew){event.preventDefault();var formData=$("#"+config.formId).serialize();var rowId=$("#"+config.modelId).val();var selector="#"+config.rowPrefix+rowId;var requestType=(isNew||config.usePostUpdate)?"post":"put";$.ajax({type:requestType,url:url,data:formData,dataType:"html",success:function(html){$(selector).replaceWith(html);var flashRow=isNew?"tbody tr:last":selector;if(config.useHighlight){$(flashRow).effect("highlight",{},3000)}methods.showEditLinks();methods.registerEditLinks();methods.registerDeleteLinks()}})},showEditLinks:function(){$("#"+config.addLink).parents("tr").show();$("."+config.editLink).show();$("."+config.deleteLink).show()},hideEditLinks:function(){$("#"+config.addLink).parents("tr").hide();$("."+config.editLink).hide();$("."+config.deleteLink).hide()}};methods.ensureFormExists();methods.registerAddLink();methods.registerEditLinks();methods.registerDeleteLinks()})()})}})(jQuery);
